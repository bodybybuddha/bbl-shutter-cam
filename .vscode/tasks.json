{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Install dependencies",
      "type": "shell",
      "command": "pip",
      "args": ["install", "-e", ".[dev]"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Build executable",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/build.sh",
      "windows": {
        "command": "${workspaceFolder}/scripts/build.bat"
      },
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "Build executable (debug)",
      "type": "shell",
      "command": "python",
      "args": ["-m", "PyInstaller", "bbl-shutter-cam.spec", "--debug=all"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "group": "build"
    },
    {
      "label": "Run tests",
      "type": "shell",
      "command": "python",
      "args": ["-m", "pytest", "tests/", "-v"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "group": {
        "kind": "test",
        "isDefault": true
      }
    },
    {
      "label": "Run tests with coverage",
      "type": "shell",
      "command": "python",
      "args": ["-m", "pytest", "tests/", "-v", "--cov=src/bbl_shutter_cam", "--cov-report=html"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "group": "test"
    },
    {
      "label": "Lint with pylint",
      "type": "shell",
      "command": "python",
      "args": ["-m", "pylint", "src/bbl_shutter_cam/"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [
        {
          "owner": "pylint",
          "fileLocation": ["relative", "${workspaceFolder}"],
          "pattern": {
            "regexp": "^([^:]+):(\\d+):(\\d+): ([A-Z]\\d{4}):(.*)$",
            "file": 1,
            "line": 2,
            "column": 3,
            "code": 4,
            "message": 5
          }
        }
      ]
    },
    {
      "label": "Format code with black",
      "type": "shell",
      "command": "python",
      "args": ["-m", "black", "src/", "tests/", "scripts/"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Type check with mypy",
      "type": "shell",
      "command": "python",
      "args": ["-m", "mypy", "src/bbl_shutter_cam/"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [
        {
          "owner": "mypy",
          "fileLocation": ["relative", "${workspaceFolder}"],
          "pattern": {
            "regexp": "^([^:]+):(\\d+): ([a-z]+): (.*)$",
            "file": 1,
            "line": 2,
            "severity": 3,
            "message": 4
          }
        }
      ]
    },
    {
      "label": "Clean build artifacts",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "rm -rf build/ dist/ *.egg-info .pytest_cache .mypy_cache .coverage htmlcov/"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "silent",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "Dev environment setup",
      "type": "shell",
      "dependsOn": ["Install dependencies", "Format code with black", "Lint with pylint"],
      "dependsOrder": "sequence",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    }
  ]
}
